/*
    Computational verifications for Z(15,2)
*/
Attach("../ZNr-equations.m");
QQ := Rationals();

// ---------------------------
// W(5, 2)
KK<a,b> := FunctionField(QQ, 2);

A := 4*(a^4 + 4*a^3 - 10*a^2*b + 6*a^2 - 24*a*b^2 - 5*a*b + 4*a + 16*b^2 + 14*b + 1);

B := (8*a^6 + 48*a^5 - 120*a^4*b + 120*a^4 + 576*a^3*b^2 - 300*a^3*b + 160*a^3 + 
348*a^2*b^2 - 504*a^2*b + 120*a^2 - 1800*a*b^3 + 1308*a*b^2 - 588*a*b + 48*a - 
216*b^4 - 1540*b^3 - 489*b^2 - 264*b + 8);

JJ := A^(3)/(-2^6*(3)^(6)*(b)^(3)*(2*a - b + 1)^(5));
JJ_1 := B^(2)/(-(2)^(6)*(3)^(6)*(b)^(3)*(2*a - b + 1)^(5));

c6_prod := (2)*(8*a^6 + 48*a^5 - 120*a^4*b + 120*a^4 + 576*a^3*b^2 - 
300*a^3*b + 160*a^3 + 348*a^2*b^2 - 504*a^2*b + 120*a^2 - 1800*a*b^3 + 
1308*a*b^2 - 588*a*b + 48*a - 216*b^4 - 1540*b^3 - 489*b^2 - 264*b + 8);

//---------------------------
// W(5, 2)^{cbrt}
P<alpha_prime> := PolynomialRing(KK);

alpha := A/(2^2*3^2*b*(2*a - b + 1)^2) * alpha_prime;

f := alpha^3 - JJ;
f := f * (64*3^6*b^3*(2*a - b + 1)^6)/A^3; // rescale
assert f eq alpha_prime^3 + 2*a - b + 1;

//parametrise the surface
A3<a,b,alpha_prime> := AffineSpace(QQ, 3);
A2<c,d> := AffineSpace(QQ, 2);

W5_2_cbrt := Surface(A3, eval Sprint(f));
phi := map<A2 -> W5_2_cbrt | [ 1/2*c - 1/2, c + d^3, d ]>;

assert IsInvertible(phi);

//---------------------------
//W+(15, 3)
KK<c,d> := FunctionField(QQ, 2);
P<eta_prime,theta_prime> := PolynomialRing(KK,2);

a,b,_ := Explode([ 1/2*c - 1/2, c + d^3, d ]);
JJ := Evaluate(JJ, [a,b]); JJ_1 := Evaluate(JJ_1, [a,b]);
c6_prod := Evaluate(c6_prod, [a,b]);
_, alpha := IsPower(JJ,3);
B := Evaluate(B, [a,b]);

g1 := -1*(c^5*d - 45*c^5 - 46*c^4*d^3 + 101*c^4*d^2 - 25*c^4*d - 325*c^4 + 100*c^3*d^5
- 136*c^3*d^4 - 1222*c^3*d^3 - 2478*c^3*d^2 - 540*c^3*d + 1150*c^3 - 104*c^2*d^7
- 1372*c^2*d^6 - 5580*c^2*d^5 - 624*c^2*d^4 + 1886*c^2*d^3 + 969*c^2*d^2 -
1615*c^2*d - 8625*c^2 - 480*c*d^9 - 3872*c*d^8 + 184*c*d^7 + 128*c*d^6 +
2020*c*d^5 - 2772*c*d^4 - 16158*c*d^3 - 372*c*d^2 - 715*c*d + 325*c - 768*d^11 +
256*d^10 - 576*d^9 + 1120*d^8 - 1072*d^7 - 7568*d^6 - 520*d^5 - 872*d^4 +
284*d^3 + 76*d^2 + 78*d + 40)^(1);

g2 := -1*(c^5*d - 26*c^5 - 26*c^4*d^3 + 37*c^4*d^2 + 25*c^4*d - 65*c^4 + 36*c^3*d^5 +
28*c^3*d^4 - 254*c^3*d^3 - 1206*c^3*d^2 + 10*c^3*d + 2185*c^3 + 8*c^2*d^7 -
284*c^2*d^6 - 2740*c^2*d^5 + 232*c^2*d^4 + 5178*c^2*d^3 + 323*c^2*d^2 -
1615*c^2*d - 3220*c^2 - 96*c*d^9 - 1920*c*d^8 + 360*c*d^7 + 3744*c*d^6 +
708*c*d^5 - 2964*c*d^4 - 5982*c*d^3 - 504*c*d^2 - 165*c*d + 195*c - 384*d^11 +
128*d^10 + 768*d^9 + 400*d^8 - 1312*d^7 - 2792*d^6 - 544*d^5 - 224*d^4 + 200*d^3
+ 22*d^2 + 28*d + 7)^(1);

g3 := 1*(2)^(1)*(9*c^6 + 10*c^5*d^3 - 34*c^5*d^2 + 57*c^5*d + 2*c^5 - 32*c^4*d^5 +
112*c^4*d^4 + 267*c^4*d^3 + 550*c^4*d^2 + 255*c^4*d - 685*c^4 + 56*c^3*d^7 +
456*c^3*d^6 + 1100*c^3*d^5 + 174*c^3*d^4 - 1706*c^3*d^3 - 2715*c^3*d^2 -
4320*c^3*d + 3335*c^3 + 192*c^2*d^9 + 736*c^2*d^8 - 228*c^2*d^7 - 1176*c^2*d^6 -
5672*c^2*d^5 - 10032*c^2*d^4 + 4903*c^2*d^3 + 3810*c^2*d^2 - 1635*c^2*d -
12140*c^2 + 192*c*d^11 - 160*c*d^10 - 160*c*d^9 - 3384*c*d^8 - 7288*c*d^7 -
228*c*d^6 + 7612*c*d^5 - 3294*c*d^4 - 21734*c*d^3 - 665*c*d^2 - 1215*c*d + 447*c
- 384*d^11 - 1600*d^10 - 1728*d^9 + 3824*d^8 - 1520*d^7 - 9688*d^6 - 824*d^5 -
1468*d^4 + 412*d^3 + 98*d^2 + 126*d + 56)^(1);

g4 := 1*(c^7*d + 183*c^7 + 182*c^6*d^3 - 175*c^6*d^2 + 641*c^6*d + 2333*c^6 -
176*c^5*d^5 + 1512*c^5*d^4 + 10238*c^5*d^3 + 9180*c^5*d^2 + 10999*c^5*d +
26707*c^5 + 880*c^4*d^7 + 13432*c^4*d^6 + 23384*c^4*d^5 + 35720*c^4*d^4 +
115800*c^4*d^3 - 87550*c^4*d^2 + 35020*c^4*d + 269210*c^4 + 5520*c^3*d^9 +
19280*c^3*d^8 + 39600*c^3*d^7 + 194608*c^3*d^6 - 292912*c^3*d^5 + 85160*c^3*d^4
+ 929460*c^3*d^3 - 51300*c^3*d^2 - 101365*c^3*d + 117905*c^3 + 5088*c^2*d^11 +
16016*c^2*d^10 + 157904*c^2*d^9 - 356624*c^2*d^8 + 56400*c^2*d^7 +
1196024*c^2*d^6 - 129064*c^2*d^5 - 301200*c^2*d^4 + 315070*c^2*d^3 +
7225*c^2*d^2 + 42653*c^2*d + 33949*c^2 + 1152*c*d^13 + 61824*c*d^12 -
184736*c*d^11 - 3968*c*d^10 + 678224*c*d^9 - 104944*c*d^8 - 300560*c*d^7 +
279584*c*d^6 + 14992*c*d^5 + 88880*c*d^4 + 70366*c*d^3 - 187*c*d - 3731*c +
9216*d^15 - 33792*d^14 - 10496*d^13 + 143232*d^12 - 26048*d^11 - 99648*d^10 +
81376*d^9 + 6144*d^8 + 44640*d^7 + 36960*d^6 + 1056*d^5 + 856*d^4 - 3756*d^3 -
260*d^2 - 258*d - 44)^(1);

g5 := 1*(c^7*d + 82*c^7 + 82*c^6*d^3 - 47*c^6*d^2 + 463*c^6*d + 187*c^6 - 48*c^5*d^5 +
1016*c^5*d^4 + 2018*c^5*d^3 + 4284*c^5*d^2 + 10625*c^5*d + 3893*c^5 +
560*c^4*d^7 + 3512*c^4*d^6 + 11496*c^4*d^5 + 39308*c^4*d^4 + 25580*c^4*d^3 -
41820*c^4*d^2 + 60690*c^4*d + 131265*c^4 + 1680*c^3*d^9 + 10176*c^3*d^8 +
52528*c^3*d^7 + 57040*c^3*d^6 - 139728*c^3*d^5 + 200336*c^3*d^4 + 443420*c^3*d^3
- 30780*c^3*d^2 - 15785*c^3*d - 6680*c^3 + 2976*c^2*d^11 + 29584*c^2*d^10 +
57520*c^2*d^9 - 170736*c^2*d^8 + 243152*c^2*d^7 + 551672*c^2*d^6 - 81096*c^2*d^5
- 54488*c^2*d^4 - 22310*c^2*d^3 + 15045*c^2*d^2 + 16983*c^2*d + 18921*c^2 +
5760*c*d^13 + 26880*c*d^12 - 89568*c*d^11 + 127104*c*d^10 + 297264*c*d^9 -
70128*c*d^8 - 62064*c*d^7 - 22752*c*d^6 + 29088*c*d^5 + 35784*c*d^4 +
38706*c*d^3 + 1224*c*d^2 - 561*c*d - 1959*c + 4608*d^15 - 16896*d^14 +
23552*d^13 + 58176*d^12 - 19328*d^11 - 23072*d^10 - 7808*d^9 + 13392*d^8 +
18336*d^7 + 20304*d^6 + 1632*d^5 - 244*d^4 - 2136*d^3 - 98*d^2 - 80*d + 19)^(1);

g6 := 1*(2)^(1)*(51*c^8 + 50*c^7*d^3 - 62*c^7*d^2 + 159*c^7*d + 844*c^7 - 64*c^6*d^5 +
320*c^6*d^4 + 3921*c^6*d^3 + 3146*c^6*d^2 - 1941*c^6*d + 12472*c^6 + 160*c^5*d^7
+ 5000*c^5*d^6 + 7184*c^5*d^5 - 6642*c^5*d^4 + 50558*c^5*d^3 - 7259*c^5*d^2 -
45339*c^5*d + 91217*c^5 + 1920*c^4*d^9 + 5104*c^4*d^8 - 9304*c^4*d^7 +
82824*c^4*d^6 - 4704*c^4*d^5 - 163300*c^4*d^4 + 317010*c^4*d^3 + 208190*c^4*d^2
- 40920*c^4*d - 163305*c^4 + 1056*c^3*d^11 - 6880*c^3*d^10 + 66160*c^3*d^9 +
21232*c^3*d^8 - 215680*c^3*d^7 + 412088*c^3*d^6 + 727392*c^3*d^5 - 77220*c^3*d^4
- 679510*c^3*d^3 + 156200*c^3*d^2 + 65565*c^3*d - 233042*c^3 - 2304*c^2*d^13 +
23808*c^2*d^12 + 27536*c^2*d^11 - 123104*c^2*d^10 + 232656*c^2*d^9 +
937280*c^2*d^8 - 5224*c^2*d^7 - 1059504*c^2*d^6 + 407584*c^2*d^5 +
194080*c^2*d^4 - 607335*c^2*d^3 - 10166*c^2*d^2 - 47073*c^2*d - 37878*c^2 +
2304*c*d^15 + 8832*c*d^14 - 25472*c*d^13 + 41824*c*d^12 + 524640*c*d^11 +
60176*c*d^10 - 731984*c*d^9 + 346688*c*d^8 + 196384*c*d^7 - 523408*c*d^6 -
18944*c*d^5 - 100410*c*d^4 - 74482*c*d^3 - 727*c*d^2 - 1113*c*d + 4581*c -
4608*d^15 + 106752*d^14 + 29440*d^13 - 189120*d^12 + 94144*d^11 + 66144*d^10 -
148256*d^9 - 6816*d^8 - 50688*d^7 - 37056*d^6 - 2112*d^5 - 2876*d^4 + 4524*d^3 +
358*d^2 + 438*d + 76)^(1);

g7 := 1*(c^3*d + 15*c^3 + 14*c^2*d^3 - 55*c^2*d^2 + 29*c^2*d + 185*c^2 - 56*c*d^5 +
88*c*d^4 + 374*c*d^3 + 120*c*d^2 + 197*c*d + 205*c + 64*d^7 + 192*d^6 + 112*d^5
+ 184*d^4 + 196*d^3 - 20*d^2 - 18*d - 20)^(1);

g8 := 1*(c^3*d + 10*c^3 + 10*c^2*d^3 - 23*c^2*d^2 + 19*c^2*d + 115*c^2 - 24*c*d^5 +
48*c*d^4 + 210*c*d^3 + 72*c*d^2 + 87*c*d + 45*c + 32*d^7 + 96*d^6 + 64*d^5 +
84*d^4 + 40*d^3 - 2*d^2 - 8*d - 5)^(1);

g9 := 1*(2)^(1)*(3*c^4 + 2*c^3*d^3 - 14*c^3*d^2 + 15*c^3*d + 16*c^3 - 16*c^2*d^5 +
32*c^2*d^4 + 57*c^2*d^3 + 74*c^2*d^2 + 135*c^2*d - 218*c^2 + 16*c*d^7 + 40*c*d^6
+ 72*c*d^5 + 102*c*d^4 - 442*c*d^3 - 103*c*d^2 - 345*c*d - 291*c - 32*d^7 -
240*d^6 - 80*d^5 - 332*d^4 - 260*d^3 + 22*d^2 + 30*d + 28)^(1);

eta := (g1*eta_prime + g2*theta_prime + g3)/(g7*eta_prime + g8*theta_prime + g9);
theta := (g4*eta_prime + g5*theta_prime + g6)/(g7*eta_prime + g8*theta_prime + g9);
beta := B/(2^5*3^4*d^10*(c + d^3)^2)*eta;

Q1 := 2*eta_prime^2 + eta_prime*theta_prime + (3*c - 4*d - 11)*eta_prime +
      (c - 2*d - 3)*theta_prime + c^2 - 2*c*d - 7*c + 10*d + 15;
Q2 := (-2*d - 5)*eta_prime^2 + (-3*d - 5)*eta_prime*theta_prime +
      (-c*d - 7*c - 7*d^2 + 2*d + 24)*eta_prime + (-d - 1)*theta_prime^2 +
      (-c*d - 4*c - 5*d^2 + 6*d + 13)*theta_prime - 2*c^2 - 2*c*d^2 - 6*c*d +
      18*c - 6*d^3 + 19*d^2 + 12*d - 28;

f := beta^4 - 6*(alpha + 1)*JJ_1*beta^2 - 8*JJ_1^2*beta - 3*(alpha - 1)^2*JJ_1^2;
assert Numerator(f) in ideal<P | [Q1,Q2]>;
assert Numerator(eta^2 - theta) in ideal<P | [Q1,Q2]>;

// for later use need to store beta
P<eta_prime, theta_prime> := FunctionField(KK,2);
beta := Evaluate(beta, [eta_prime, theta_prime]);

//parametrise the surface
A4<c,d,eta_prime,theta_prime> := AffineSpace(QQ, 4);
A2<s,t> := AffineSpace(QQ, 2);

W15_2_plus := Surface(A4, [eval Sprint(Q1), eval Sprint(Q2)]);
phi := map<A2 -> W15_2_plus | [
-(s^2*t + 5*s*t - s + t^2 + 4*t - 1)*(s^4*t + 2*s^3*t + 2*s^2*t^2 + s^2*t +
2*s*t^2 + t^3 - 16*t^2 + 8*t - 1)/((s^2 + s + t)^(1)*(s^2*t - 3*s*t + s + t^2)^(2)),
(s^2*t + s*t + t^2 - 4*t + 1)/((s^2*t - 3*s*t + s + t^2)^(1)),
(5*s^6*t^2 - 13*s^5*t^2 + 7*s^5*t + 15*s^4*t^3 + 15*s^4*t^2 - 16*s^4*t + 4*s^4
- 26*s^3*t^3 + 87*s^3*t^2 - 45*s^3*t + 7*s^3 + 15*s^2*t^4 - 9*s^2*t^3 +
34*s^2*t^2 - 19*s^2*t + 3*s^2 - 13*s*t^4 - 41*s*t^3 + 36*s*t^2 - 10*s*t + s +
5*t^5 - 24*t^4 - 54*t^3 + 47*t^2 - 12*t + 1)/((s^2 + s + t)^(1)*(s^2*t - 3*s*t +
s + t^2)^(2)),
-(5*s^6*t^2 - 9*s^5*t^2 + 6*s^5*t + 15*s^4*t^3 - 5*s^4*t^2 - 7*s^4*t + 3*s^4 -
18*s^3*t^3 + 97*s^3*t^2 - 56*s^3*t + 9*s^3 + 15*s^2*t^4 - 57*s^2*t^3 +
90*s^2*t^2 - 42*s^2*t + 6*s^2 - 9*s*t^4 + 30*s*t^3 - 22*s*t^2 + 4*s*t + 5*t^5 -
52*t^4 - 43*t^3 + 46*t^2 - 12*t + 1)/((s^2 + s + t)^(1)*(s^2*t - 3*s*t + s + t^2)^(2))
]>;
//assert IsInvertible(phi);

//---------------------------
//W(15, 2)
KK<s,t> := FunctionField(QQ, 2);

c,d,eta_prime,theta_prime := Explode([
-(s^2*t + 5*s*t - s + t^2 + 4*t - 1)*(s^4*t + 2*s^3*t + 2*s^2*t^2 + s^2*t +
2*s*t^2 + t^3 - 16*t^2 + 8*t - 1)/((s^2 + s + t)^(1)*(s^2*t - 3*s*t + s + t^2)^(2)),
(s^2*t + s*t + t^2 - 4*t + 1)/((s^2*t - 3*s*t + s + t^2)^(1)),
(5*s^6*t^2 - 13*s^5*t^2 + 7*s^5*t + 15*s^4*t^3 + 15*s^4*t^2 - 16*s^4*t + 4*s^4
- 26*s^3*t^3 + 87*s^3*t^2 - 45*s^3*t + 7*s^3 + 15*s^2*t^4 - 9*s^2*t^3 +
34*s^2*t^2 - 19*s^2*t + 3*s^2 - 13*s*t^4 - 41*s*t^3 + 36*s*t^2 - 10*s*t + s +
5*t^5 - 24*t^4 - 54*t^3 + 47*t^2 - 12*t + 1)/((s^2 + s + t)^(1)*(s^2*t - 3*s*t +
s + t^2)^(2)),
-(5*s^6*t^2 - 9*s^5*t^2 + 6*s^5*t + 15*s^4*t^3 - 5*s^4*t^2 - 7*s^4*t + 3*s^4 -
18*s^3*t^3 + 97*s^3*t^2 - 56*s^3*t + 9*s^3 + 15*s^2*t^4 - 57*s^2*t^3 +
90*s^2*t^2 - 42*s^2*t + 6*s^2 - 9*s*t^4 + 30*s*t^3 - 22*s*t^2 + 4*s*t + 5*t^5 -
52*t^4 - 43*t^3 + 46*t^2 - 12*t + 1)/((s^2 + s + t)^(1)*(s^2*t - 3*s*t + s + t^2)^(2))
                                      ]);

JJ := Evaluate(JJ, [c,d]); JJ_1 := Evaluate(JJ_1, [c,d]);
c6_prod := Evaluate(c6_prod, [c,d]);
beta := eval Sprint(beta);

assert IsSquare(3*c6_prod*beta / (-(4*t - 1)));

//parametrise the surface
A3<s,t,w> := AffineSpace(QQ, 3);
A2<u,v> := AffineSpace(QQ, 2);

W15_2 := Surface(A3, w^2 - (-4*t + 1));
phi := map<A2 -> W15_2 | [
(u*v^2 - u - v^2)/((v)^(1)*(v - 1)),
-(v - 1)*(u)*(u*v - u - v)/((v)^(2)),
(2*u*v - 2*u - v)/v
]>;
assert IsInvertible(phi);

//---------------------------
//Z(15, 2)
KK<u,v> := FunctionField(QQ,2);
s,t,_ := Explode([
(u*v^2 - u - v^2)/((v)^(1)*(v - 1)),
-(v - 1)*(u)*(u*v - u - v)/((v)^(2)),
(2*u*v - 2*u - v)/v
]);

JJ := Evaluate(JJ, [s,t]);
JJ_1 := Evaluate(JJ_1, [s,t]);

////////////////////
// Equation
f := -ZNrEquations(15,2 : vars:=[u,v,0])[1];

J_diff := (-JJ_1 + JJ + 1)^2 - 4*JJ;
assert IsSquare(f*J_diff);

////////////////////
// j-invs
jj, jj_1728 := WNrModuli(15,2 : vars:=[u,v]);
assert 1728^2*JJ eq jj;
assert 1728^2*JJ_1 eq jj_1728;


